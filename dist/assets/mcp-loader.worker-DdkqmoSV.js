(function(){"use strict";const i=`${`${`https://${self.location.host}`}/mcp/api/v1`}/mcp`;let a=null,c="",l={},n=null,h=0;const d=3e4;function p(){if(Object.keys(l).length>0)return{...l};const r={"Content-Type":"application/json"};return a&&(r.Authorization=`Bearer ${a}`),r}async function f(){try{const r=Date.now();if(n&&r-h<d)return console.log("âš¡ Worker: Using cached MCP servers"),n;console.time("ðŸ”§ Worker: Load MCP servers");const o=`${c||""}${i}/list`,e=await fetch(o,{headers:p()});if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const s=await e.json();let t=[];return Array.isArray(s)?t=s:s&&Array.isArray(s.servers)&&(t=s.servers),n=t,h=r,console.timeEnd("ðŸ”§ Worker: Load MCP servers"),console.log(`âœ… Worker: Loaded ${t.length} MCP servers`),t}catch(r){throw console.error("âŒ Worker: Failed to load MCP servers",r),r}}async function E(r){try{console.time(`ðŸ”„ Worker: Refresh server ${r}`);const o=`${c||""}${i}/${r}/refresh`,e=await fetch(o,{method:"POST",headers:p()});if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const s=await e.json();return console.timeEnd(`ðŸ”„ Worker: Refresh server ${r}`),n=null,s}catch(o){throw console.error(`âŒ Worker: Failed to refresh server ${r}`,o),o}}self.addEventListener("message",async r=>{const{type:o,payload:e}=r.data;try{switch(o){case"LOAD_MCP_SERVERS":{e?.headers&&(l=e.headers),e?.token!==void 0&&(a=e.token),e?.baseUrl&&(c=e.baseUrl);const t={type:"MCP_SERVERS_LOADED",payload:await f()};self.postMessage(t);break}case"REFRESH_MCP_SERVER":{if(!e?.serverId)throw new Error("serverId is required for REFRESH_MCP_SERVER");const t={type:"MCP_SERVER_REFRESHED",payload:await E(e.serverId)};self.postMessage(t);break}default:console.warn("Worker: Unknown message type",o)}}catch(s){const t={type:"ERROR",payload:null,error:s instanceof Error?s.message:String(s)};self.postMessage(t)}}),self.postMessage({type:"READY",payload:null})})();
